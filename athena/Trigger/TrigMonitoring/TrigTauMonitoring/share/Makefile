#export TEXINPUTS=.//:/usr/share/texmf/tex/latex//:../../../external//:

#-------------------------------------------------------------------------------
# user variables
#-------------------------------------------------------------------------------
doc = plotbook
latex = latex # latex or pdflatex
gv_scale = 1

#-------------------------------------------------------------------------------

deps := $(wildcard *.tex figs/*.pdf figs/*.eps) 
alltexs := $(wildcard *.tex)
texs = $(filter-out $(doc).tex,$(alltexs))
 
#-------------------------------------------------------------------------------
# targets
#-------------------------------------------------------------------------------
#default: $(doc).pdf show
default: $(doc).pdf
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	@echo "Your dependencies are: $(deps)"

$(doc).pdf: $(deps)
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	@make $(latex)

.PHONY: pdflatex
pdflatex:
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	pdflatex $(doc).tex
	pdflatex $(doc).tex

.PHONY: latex
latex: $(doc).ps
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	ps2pdf -sPAPERSIZE=a4 -dAutoRotatePages#/PageByPage $(doc).ps $(doc).pdf
	
$(doc).ps: $(doc).dvi
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	dvips -o $(doc).ps $(doc).dvi

$(doc).dvi: $(doc).tex
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	latex $(doc).tex
	latex $(doc).tex

.PHONY: over
over: realclean default
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"

.PHONY: clean
clean:
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	rm -f *.aux $(doc).bbl $(doc).blg $(doc).dvi $(doc).log $(doc).nav $(doc).out $(doc).ps $(doc).snm $(doc).toc

.PHONY: realclean
realclean: clean
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	rm -f $(doc).pdf

.PHONY: show
show:
	@echo "--------------------------------------------------------------------------------"
	@echo "make $@"
	@echo "--------------------------------------------------------------------------------"
	@if [ `ps ax | grep -v grep | grep gv | grep -c $(doc).pdf` -eq 0 ]; then\
		echo "Opening document with ghostview...";\
		sleep 2;\
		gv -antialias -watch -scale=$(gv_scale) -resize $(doc).pdf & \
	else \
		echo "Document is already open with ghostview.";\
	fi

